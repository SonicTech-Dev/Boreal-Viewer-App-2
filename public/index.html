<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>BOREAL-CH4 MONITOR</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#2e405e;
      --panel:#071426;
      --card:#0b1220;
      --muted:#9aa6b2;
      --accent:#06b6d4;
      --accent-2:#60a5fa;
      --success:#10b981;
      --danger:#f97316;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      background: linear-gradient(180deg,var(--bg) 0%, #06132a 60%);
      color:#e6eef6;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      height:100vh;
      display:flex;
      flex-direction:column;
    }

    /* Header across the top (centered title) */
    header.app-header {
      display:flex;
      align-items:center;
      justify-content:center; /* center the whole header content */
      gap:12px;
      padding:12px 20px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-bottom: 1px solid rgba(255,255,255,0.03);
      height:92px;
      position:relative;
    }
    .brand { display:flex; align-items:center; gap:14px; position:absolute; left:20px; } /* keep logo at left */
    .logo {
      width:320px;height:90px;border-radius:8px; overflow:hidden;
      display:flex;align-items:center;justify-content:center;font-weight:700;color:#042;
      flex-shrink:0;
      background:transparent;
    }
    .logo img { width:100%; height:100%; object-fit:cover; display:block; }

    .title {
      display:flex;flex-direction:column; line-height:1; text-align:center;
    }
    .title h1 { margin:0; font-size:42px; letter-spacing:0.6px; }
    .title .subtitle { margin-top:6px; color:var(--muted); font-size:13px; }

    .status {
      display:flex;align-items:center;gap:10px;
      position:absolute; right:20px; /* status at the right */
    }
    .local-time {
      color:var(--muted);
      font-weight:600;
      font-size:13px;
      white-space:nowrap;
    }
    .dot { width:20px;height:20px;border-radius:50%; background:var(--danger); box-shadow:0 0 10px rgba(249,115,22,0.14); }
    .status-label { font-weight:700; color:var(--muted); }

    /* Main content area takes remaining height */
    .content {
      display:grid;
      grid-template-columns: 1fr; /* single column now */
      gap:16px;
      padding:16px;
      height: calc(100vh - 92px);
      align-items:start;
      overflow:hidden;
    }

    /* Main column (full width) is scrollable and contains tiles + query */
    .main-col {
      display:flex;
      flex-direction:column;
      gap:12px;
      height:100%;
      overflow:auto;
      padding-right:8px;
      align-items:stretch;
    }

    /* Centre the laser image under the title */
    .hero {
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:8px;
      margin-bottom:6px;
    }
    .hero img {
      max-width:500px;
      width:100%;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.04);
      box-shadow: 0 12px 30px rgba(2,6,23,0.5);
    }
    .hero .caption { color:var(--muted); font-size:13px; margin-top:6px; }

    .tiles {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 24px;
      width: 100%;
    }

    .tile {
      background: var(--card);
      border-radius: 12px;
      padding: 12px;
      min-height: 96px;
      border: 1px solid rgba(255,255,255,0.03);
      transition: transform .12s ease, box-shadow .12s ease;
      position: relative;
      overflow: visible;
    }
    .tile:hover { transform: translateY(-6px); box-shadow: 0 18px 36px rgba(0,0,0,0.6); }
    .tile .label { color:var(--muted); font-size:13px; }
    .tile .value { font-size:26px; font-weight:700; margin-top:6px; }
    .tile .meta { font-size:12px; color:var(--muted); margin-top:6px; }

    .popup {
      position:absolute; right:10px; top:10px;
      background:rgba(3,10,20,0.96); padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);
      display:none; min-width:180px; z-index:5;
    }
    .tile:hover .popup { display:block; }

    /* --- Custom styling for LoS-PPM (GasFinder-PPM) value --- */
    /* target the tile created with apiField "los_ppm" and its popup value */
    #tile-los_ppm .value,
    #popup-los_ppm #popup-val-los_ppm {
      color: var(--accent-2);
    }

    /* Query panel (below tiles) */
    .panel {
      background:var(--card);
      padding:12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.03);
    }
    .controls { display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
    label.inline { color:var(--muted); font-size:13px; margin-right:6px; }
    input[type="datetime-local"]{ padding:8px; border-radius:6px; border:1px solid rgba(255,255,255,0.06); background:transparent; color:inherit; }
    .btn { padding:8px 10px; border-radius:8px; border:0; background:var(--accent); color:#042; cursor:pointer; }
    .btn:hover { background:var(--accent-2); color: #858383; }
    .btn.secondary { background:var(--accent-2); color:#042; }
    .btn.secondary:hover { background:var(--accent); color: #858383; }
    .quick { display:flex; gap:8px; margin-top:8px; flex-wrap:wrap; }

    .results { margin-top:12px; max-height:360px; overflow:auto; background:rgba(255,255,255,0.01); padding:8px; border-radius:8px; }
    table.table { width:100%; border-collapse:collapse; font-family:monospace; }
    table.table th, table.table td { padding:8px; border-bottom:1px solid rgba(255,255,255,0.02); text-align:left; font-size:13px; }

    /* Footer at bottom */
    footer.app-footer {
      padding:8px 16px;
      text-align:center;
      color:var(--muted);
      font-size:13px;
      border-top:1px solid rgba(255,255,255,0.02);
      background: linear-gradient(180deg, rgba(255,255,255,0.005), transparent);
    }
    footer.app-footer-version {
      padding:1px 10px;
      text-align:center;
      color:var(--muted);
      font-size:10px;
      border-top:1px solid rgba(255,255,255,0.02);
      background: linear-gradient(180deg, rgba(255,255,255,0.005), transparent);
    }

    /*
      RESPONSIVE ADJUSTMENTS
      - Reduce header height on small screens
      - Allow brand/title/status to wrap and reflow
      - Shrink logo and text so they don't overlap/collapse
      - Move status under title on narrow screens
    */
    @media (max-width:1100px){
      .content { grid-template-columns: 1fr; }
      .hero img { max-width:100%; }
    }

    @media (max-width:800px){
      header.app-header {
        height: auto;
        padding:12px;
        align-items:flex-start;
      }
      /* allow brand/title/status to stack */
      .brand {
        position:static;
        order:0;
        left:auto;
        margin-bottom:8px;
      }
      .logo {
        width:220px;
        height:48px;
      }
      .title {
        order:1;
        width:100%;
        text-align:left;
        margin-left:4px;
      }
      .title h1 { font-size:30px; }
      .title .subtitle { font-size:12px; }

      .status {
        position:static;
        order:2;
        margin-top:8px;
        width:100%;
        justify-content:flex-start;
      }
      .status-label { font-size:13px; color:var(--muted); }

      /* reduce padding on tiles and controls for small screens */
      .tile { padding:10px; min-height:80px; }
      .panel { padding:10px; }
      .controls { gap:6px; }
      .btn { padding:7px 8px; font-size:13px; }
    }

    /* Very small screens / phones */
    @media (max-width:420px){
      header.app-header { padding:10px; }
      .brand { display:flex; align-items:center; gap:10px; }
      .logo { width:160px; height:40px; }
      .title h1 { font-size:16px; }
      .title .subtitle { font-size:11px; }
      .hero img { max-width:260px; }
      /* collapse status dot/label to smaller */
      .dot { width:14px; height:14px; }
      .status-label { font-size:12px; }
      .tiles { gap:12px; }
      .tile .value { font-size:20px; }
    }

    /* If the logo image is very wide and may still cause overflow, allow it to shrink */
    .logo img { max-width:100%; height:auto; object-fit:contain; display:block; }

    /* Ensure content area shrinks correctly on very short viewports (mobile browsers with address bar) */
    @supports (height: 100svh) {
      .content { height: calc(100svh - 92px); }
    }
    @supports (height: 100dvh) {
      .content { height: calc(100dvh - 92px); }
    }

  </style>
</head>
<body>
  <header class="app-header" role="banner" aria-label="BOREAL header">
    <div class="brand" aria-hidden="false">
      <!-- logo image from public/static/logo.png -->
      <div class="logo" id="logo"><img src="/Static/boreal.png" alt="BOREAL logo" /></div>
    </div>

    <div class="title" role="heading" aria-level="1">
      <h1>CH4 REMOTE MONITOR</h1>
      <div class="subtitle">Realtime GasFinder CH4 Remote Monitoring</div>
    </div>

    <!-- Local time (left) + Status widget (right) -->
    <div class="status" aria-live="polite" aria-atomic="true">
      <div id="local-time" class="local-time" title="Local device time">—</div>
      <div id="status-dot" class="dot" title="Device status"></div>
      <div id="status-label" class="status-label">Checking…</div>
    </div>

  </header>

  <div class="content" role="main">
    <div class="main-col">
      <!-- hero laser image centered under heading -->
      <div class="hero" aria-hidden="false">
        <!-- laser image from public/static/laser.png -->
        <img src="/Static/Laser.png" alt="Laser photo" id="hero-image" />
      </div>

      <div class="tiles" id="tiles"><!-- tiles injected by client.js --></div>

      <div class="panel" id="query-panel">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <div style="font-weight:600">SQL Query / Viewer</div>
        </div>

        <div class="controls">
          <label class="inline">From:</label>
          <input id="from" type="datetime-local" />
          <label class="inline">To:</label>
          <input id="to" type="datetime-local" />
          <button id="fetch" class="btn">Query</button>
          <button id="clear-results" class="btn secondary">Clear</button>
          <button id="export-csv" class="btn" title="Export current results">CSV</button>
        </div>

        <div class="quick" id="presets-row">
          <button class="btn preset" data-range="1h">1h</button>
          <button class="btn preset" data-range="6h">6h</button>
          <button class="btn preset" data-range="12h">12h</button>
          <button class="btn preset" data-range="24h">24h</button>
          <button class="btn preset" data-range="7d">7d</button>
          <button class="btn preset" data-range="30d">30d</button>
        </div>

        <div class="results" id="results">
          <!-- intentionally left blank until a query is run -->
        </div>
      </div>
    </div>
  </div>
  <footer class="app-footer-version">2025 V1.68</footer>
  <footer class="app-footer">Powered by SONIC</footer>


  <script src="/socket.io/socket.io.js"></script>
  <script src="/client.js"></script>
  <script src="/query-client.js"></script>
</body>
</html>
